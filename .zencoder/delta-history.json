{"snapshots":{"/terminal_output":{"filePath":"/terminal_output","baseContent":"(OGOS_fastapi_pdfmodule) miketenhoonte@iMac-Mike-2023 OGOS_fastapi_pdfmodule % \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","baseTimestamp":1757669613983},"/Users/miketenhoonte/PROJECTS/Ogos-pdf-module-ogos/OGOS_fastapi_pdfmodule/README.md":{"filePath":"/Users/miketenhoonte/PROJECTS/Ogos-pdf-module-ogos/OGOS_fastapi_pdfmodule/README.md","baseContent":"# FastAPI PDF Dieline Processor\n\nA FastAPI service for processing PDF files with dielines/stanslines. The service can detect existing dielines, analyze PDF properties, and modify or replace dielines based on shape specifications.\n\n## Features\n\n- **PDF Analysis**: Extract dimensions, trimbox, and detect existing dielines\n- **Shape Support**: \n  - Circle/Oval\n  - Rectangle (with optional corner radius)\n  - Custom/Irregular shapes\n- **Spot Color Handling**: Detect and manipulate spot colors (CutContour, KissCut, stans, etc.)\n- **Dieline Processing**:\n  - For circles/rectangles: Remove existing dieline and add new one\n  - For custom shapes: Keep existing shape but rename spot color\n- **Standards Compliant**: Creates dielines with 0.5pt 100% magenta lines with overprint\n\n## Installation\n\n### Prerequisites\n- Python 3.10+\n- UV package manager\n\n### Setup\n\n1. Clone the repository:\n```bash\ngit clone <repository-url>\ncd OGOS_fastapi_pdfmodule\n```\n\n2. Install dependencies using UV:\n```bash\nuv sync\n```\n\n3. Run the development server:\n```bash\nuv run uvicorn main:app --reload\n```\n\nThe API will be available at `http://localhost:8000`\n\n## API Endpoints\n\n### 1. Analyze PDF\n**POST** `/api/pdf/analyze`\n\nAnalyzes a PDF file and returns information about its dimensions, trimbox, and detected dielines.\n\n**Request:**\n- Form data with PDF file upload\n\n**Response:**\n```json\n{\n  \"pdf_size\": {\"width\": 595.0, \"height\": 842.0},\n  \"page_count\": 1,\n  \"trimbox\": {\"x0\": 0, \"y0\": 0, \"x1\": 595, \"y1\": 842},\n  \"mediabox\": {\"x0\": 0, \"y0\": 0, \"x1\": 595, \"y1\": 842},\n  \"detected_dielines\": [...],\n  \"spot_colors\": [\"CutContour\"],\n  \"has_cutcontour\": true\n}\n```\n\n### 2. Process PDF\n**POST** `/api/pdf/process`\n\nProcesses a PDF file with dieline modifications based on job configuration.\n\n**Request:**\n- `pdf_file`: PDF file upload\n- `job_config`: JSON string with configuration\n\n**Example job_config:**\n```json\n{\n  \"reference\": \"5355531-8352950\",\n  \"shape\": \"circle\",\n  \"width\": 50,\n  \"height\": 50,\n  \"radius\": 0,\n  \"spot_color_name\": \"stans\",\n  \"line_thickness\": 0.5\n}\n```\n\n**Response:** \n- Processed PDF file download\n\n### 3. Process PDF with JSON File\n**POST** `/api/pdf/process-with-json-file`\n\nProcesses a PDF file using a separate JSON configuration file (compatible with example JSON format).\n\n**Request:**\n- `pdf_file`: PDF file upload\n- `json_file`: JSON configuration file upload\n\n**Response:**\n- Processed PDF file download\n\n### 4. Winding Route\n**GET** `/api/pdf/route-by-winding/{winding_value}`\n\nReturns the mapped route angle (0, 90, 180, 270) for a given winding value (1-8). Accepts string or numeric input.\n\nExample:\n```bash\ncurl -s http://localhost:8000/api/pdf/route-by-winding/3\n# {\"winding_value\":\"3\",\"route\":90}\n```\n\n## Configuration\n\nThe application can be configured using environment variables or a `.env` file:\n\n```env\nAPI_TITLE=PDF Dieline Processor\nAPI_VERSION=1.0.0\nMAX_FILE_SIZE=104857600  # 100MB in bytes\nDEFAULT_SPOT_COLOR=stans\nDEFAULT_LINE_THICKNESS=0.5\nLOG_LEVEL=INFO\n```\n\n## JSON Configuration Format\n\nThe service accepts JSON configuration in the following format:\n\n```json\n{\n  \"ReferenceAtCustomer\": \"5355531-8352950\",\n  \"Description\": \"labels_on_roll\",\n  \"Shape\": \"circle\",\n  \"Width\": 50,\n  \"Height\": 50,\n  \"Radius\": 0,\n  \"Substrate\": \"mat wit PP\",\n  \"Adhesive\": \"permanent\",\n  \"Colors\": \"CMYK\",\n  \"Winding\": 2\n}\n```\n\n### Shape Types\n- `\"circle\"`: Creates circular or oval dieline\n- `\"rectangle\"`: Creates rectangular dieline with optional corner radius\n- `\"custom\"`: Preserves existing dieline shape, only renames spot color\n\n## Development\n\n### Project Structure\n```\nOGOS_fastapi_pdfmodule/\n├── app/\n│   ├── api/\n│   │   └── endpoints/\n│   │       └── pdf.py              # API endpoints\n│   ├── core/\n│   │   ├── config.py               # Configuration\n│   │   ├── pdf_analyzer.py         # PDF analysis\n│   │   ├── pdf_processor.py        # Main processing logic\n│   │   └── shape_generators.py     # Shape generation\n│   ├── models/\n│   │   └── schemas.py              # Pydantic models\n│   └── utils/\n│       ├── pdf_utils.py            # PDF utilities\n│       └── spot_color_handler.py   # Spot color manipulation\n├── examplecode/                    # Example PDFs and scripts\n├── main.py                         # FastAPI application\n├── pyproject.toml                  # Project dependencies\n└── README.md                       # This file\n```\n\n### Testing\n\nTest the API using the provided HTTP file:\n\n```bash\n# Run the server\nuv run uvicorn main:app --reload\n\n# Test endpoints using test_main.http\n```\n\nOr use curl:\n\n```bash\n# Analyze a PDF\ncurl -X POST \"http://localhost:8000/api/pdf/analyze\" \\\n  -H \"accept: application/json\" \\\n  -F \"pdf_file=@example.pdf\"\n\n# Process a PDF\ncurl -X POST \"http://localhost:8000/api/pdf/process\" \\\n  -H \"accept: application/pdf\" \\\n  -F \"pdf_file=@example.pdf\" \\\n  -F 'job_config={\"reference\":\"test-001\",\"shape\":\"circle\",\"width\":50,\"height\":50}'\n```\n\n## Technical Details\n\n### Dieline Detection\nThe service detects dielines by looking for:\n- Spot colors named: CutContour, KissCut, stans, DieCut (and variations)\n- Thin stroke-only paths (≤1.0pt line width)\n- Paths without fill color\n\n### PDF Processing\n- Uses **PyMuPDF** for PDF analysis and path extraction\n- Uses **pypdf** for spot color detection\n- Uses **ReportLab** for generating new dieline shapes\n- Preserves original PDF content while modifying only dieline elements\n\n### Spot Color Specification\nAll dielines are created with:\n- 100% Magenta (CMYK: 0, 1, 0, 0)\n- 0.5pt line thickness (configurable)\n- Overprint enabled\n- Custom spot color name (default: \"stans\")\n\n## Known Limitations\n\n1. **Custom Shape Processing**: Currently copies the PDF without full spot color renaming (placeholder implementation)\n2. **Multi-page PDFs**: Optimized for single-page label PDFs\n3. **Complex Paths**: May not detect all types of complex dieline paths\n\n## Future Enhancements\n\n- [ ] Full implementation of spot color renaming for custom shapes\n- [ ] Support for multi-page PDF processing\n- [ ] Batch processing API endpoint\n- [ ] Advanced dieline detection algorithms\n- [ ] WebSocket support for real-time processing status\n\n## License\n\n[Your License Here]\n\n## Support\n\nFor issues or questions, please contact [Your Contact Info]\n","baseTimestamp":1757670003485,"deltas":[{"timestamp":1757670480954,"changes":[{"type":"MODIFY","lineNumber":84,"content":"  \"line_thickness\": 0.5,","oldContent":"  \"line_thickness\": 0.5"},{"type":"INSERT","lineNumber":85,"content":"  \"winding\": 2"},{"type":"INSERT","lineNumber":92,"content":"Response headers include:"},{"type":"INSERT","lineNumber":93,"content":"- `X-Processing-Reference`"},{"type":"INSERT","lineNumber":94,"content":"- `X-Processing-Shape`"},{"type":"INSERT","lineNumber":95,"content":"- `X-Winding-Route` (if `winding` supplied)"},{"type":"INSERT","lineNumber":96,"content":""},{"type":"INSERT","lineNumber":97,"content":"Winding route mapping is automatically computed from `winding` using:"},{"type":"INSERT","lineNumber":98,"content":"1 → 180, 2 → 0, 3 → 90, 4 → 270, 5/6/7/8 → 0."},{"type":"INSERT","lineNumber":99,"content":""},{"type":"INSERT","lineNumber":100,"content":"Example curl (inline JSON):"},{"type":"INSERT","lineNumber":101,"content":"```bash"},{"type":"INSERT","lineNumber":102,"content":"curl -X POST http://localhost:8000/api/pdf/process \\"},{"type":"INSERT","lineNumber":103,"content":"  -F \"pdf_file=@/path/to/file.pdf\" \\"},{"type":"INSERT","lineNumber":104,"content":"  -F 'job_config={"},{"type":"INSERT","lineNumber":105,"content":"    \"reference\":\"PROD-12345\","},{"type":"INSERT","lineNumber":106,"content":"    \"shape\":\"circle\","},{"type":"INSERT","lineNumber":107,"content":"    \"width\":50,"},{"type":"INSERT","lineNumber":108,"content":"    \"height\":50,"},{"type":"INSERT","lineNumber":109,"content":"    \"spot_color_name\":\"stans\","},{"type":"INSERT","lineNumber":110,"content":"    \"line_thickness\":0.5,"},{"type":"INSERT","lineNumber":111,"content":"    \"winding\":2"},{"type":"INSERT","lineNumber":112,"content":"  }' \\"},{"type":"INSERT","lineNumber":113,"content":"  -D - \\"},{"type":"INSERT","lineNumber":114,"content":"  -o PROD-12345_processed.pdf"},{"type":"INSERT","lineNumber":115,"content":"# Look for X-Winding-Route in response headers"},{"type":"INSERT","lineNumber":116,"content":"```"},{"type":"INSERT","lineNumber":117,"content":""},{"type":"INSERT","lineNumber":130,"content":"Example JSON file content:"},{"type":"INSERT","lineNumber":131,"content":"```json"},{"type":"INSERT","lineNumber":132,"content":"{"},{"type":"INSERT","lineNumber":133,"content":"  \"ReferenceAtCustomer\": \"PROD-67890\","},{"type":"INSERT","lineNumber":134,"content":"  \"Description\": \"40x140mm rectangle, 2mm radius\","},{"type":"INSERT","lineNumber":135,"content":"  \"Shape\": \"rectangle\","},{"type":"INSERT","lineNumber":136,"content":"  \"Width\": 40,"},{"type":"INSERT","lineNumber":137,"content":"  \"Height\": 140,"},{"type":"INSERT","lineNumber":138,"content":"  \"Radius\": 2,"},{"type":"INSERT","lineNumber":139,"content":"  \"Winding\": 3,"},{"type":"INSERT","lineNumber":140,"content":"  \"Substrate\": \"PP white\","},{"type":"INSERT","lineNumber":141,"content":"  \"Adhesive\": \"permanent\","},{"type":"INSERT","lineNumber":142,"content":"  \"Colors\": \"CMYK\""},{"type":"INSERT","lineNumber":143,"content":"}"},{"type":"INSERT","lineNumber":144,"content":"```"},{"type":"INSERT","lineNumber":145,"content":""},{"type":"INSERT","lineNumber":146,"content":"Example curl (separate JSON file):"},{"type":"INSERT","lineNumber":147,"content":"```bash"},{"type":"INSERT","lineNumber":148,"content":"curl -X POST http://localhost:8000/api/pdf/process-with-json-file \\"},{"type":"INSERT","lineNumber":149,"content":"  -F \"pdf_file=@/path/to/file.pdf\" \\"},{"type":"INSERT","lineNumber":150,"content":"  -F \"json_file=@/path/to/config.json\" \\"},{"type":"INSERT","lineNumber":151,"content":"  -D - \\"},{"type":"INSERT","lineNumber":152,"content":"  -o PROD-67890_processed.pdf"},{"type":"INSERT","lineNumber":153,"content":"# Look for X-Winding-Route in response headers"},{"type":"INSERT","lineNumber":154,"content":"```"},{"type":"INSERT","lineNumber":155,"content":""},{"type":"INSERT","lineNumber":282,"content":"## Field Usage Notes"},{"type":"INSERT","lineNumber":283,"content":""},{"type":"INSERT","lineNumber":284,"content":"- `winding`: Used to compute and return a route angle via header `X-Winding-Route` and in the JSON `processing_details` of the internal result. Currently not rotating or altering the artwork; it’s metadata for downstream handling."},{"type":"INSERT","lineNumber":285,"content":"- `substrate` / `adhesive` / `colors`: Accepted and preserved in the job config, but not used to alter processing at this time. If you need behavior based on a substrate ID (e.g., different line thickness or color), we can add a rule table."},{"type":"INSERT","lineNumber":286,"content":""}]}]}}}